% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/get_bdiag_vcov.R
\name{get_bdiag_vcov}
\alias{get_bdiag_vcov}
\title{Combine variance-covariance matrices into a block-diagonal matrix}
\usage{
get_bdiag_vcov(prepped_fits_df)
}
\arguments{
\item{prepped_fits_df}{A data frame or tibble containing a list-column
named \code{vcov_obj}, where each element is a variance-covariance matrix
(typically from a fitted model).}
}
\value{
A sparse block-diagonal matrix of class \code{dgCMatrix} combining all
variance-covariance matrices in \code{vcov_obj}.
}
\description{
\code{got_bdiag_vcov()} takes a data frame of prepped model fits (as returned by
\code{\link[=prep_fit]{prep_fit()}}) and extracts each element of the \code{vcov_obj} list-column,
combining them into a single block-diagonal variance-covariance matrix
using \code{\link[Matrix:bdiag]{Matrix::bdiag()}}.

This is useful when you have multiple fitted models and you want to
represent their combined covariance structure in a single sparse matrix.
}
\details{
\itemize{
\item The function performs defensive checks to ensure the input is a data frame
and that the \code{vcov_obj} column exists and contains only matrices.
\item Uses \code{\link[Matrix:bdiag]{Matrix::bdiag()}} internally for efficient block-diagonal binding.
}
}
\examples{
\dontrun{
library(estimatr)
library(dplyr)

# Example data
dat <- data.frame(
  Y = rnorm(100),
  Z = factor(sample(c("T0", "T1", "T2"), 100, TRUE)),
  X = rnorm(100)
)

# Fit models
fit_1 <- lm_robust(Y ~ Z + X, data = dat)
fit_2 <- lm_robust(Y ~ Z + X, data = dat)

# Prep results
prepped_fit_1 <- prep_fit(fit_1, term = c("ZT1", "ZT2"))
prepped_fit_2 <- prep_fit(fit_2, term = c("ZT1"))

# Combine
prepped_fits_df <- bind_rows(prepped_fit_1, prepped_fit_2, .id = "fit")

# Create a block-diagonal vcov matrix
got_bdiag_vcov(prepped_fits_df)
}

}
